---
/**
 * WebGPU Game of Life overlay for the hero section.
 * Silently does nothing when WebGPU is unsupported â€” the CSS
 * overlay fallback in index.astro remains visible instead.
 */
---

<canvas
  id="hero-sim"
  class="absolute inset-0 w-full h-full pointer-events-none"
></canvas>

<script>
  import { GameOfLife } from "./webgpu/GameOfLife";
  import type { SimColors } from "./webgpu/GameOfLife";
  import { isDark, observeTheme, isMobile } from "./webgpu/utils";

  const LIGHT: SimColors = {
    alive: [0.0, 0.0, 0.0, 1.0],
    dead: [1.0, 1.0, 1.0, 1.0],
  };

  const DARK: SimColors = {
    alive: [1.0, 1.0, 1.0, 1.0],
    dead: [0.0, 0.0, 0.0, 1.0],
  };

  const canvas = document.getElementById("hero-sim") as HTMLCanvasElement | null;

  if (canvas) {
    const sim = new GameOfLife({
      canvas,
      cellSize: isMobile() ? 16 : 10,
      updateInterval: 150,
      initialDensity: 0.25,
      colors: isDark() ? DARK : LIGHT,
    });

    sim.start().then((ok) => {
      if (!ok) {
        canvas.remove();
        return;
      }

      document.getElementById("hero-overlay")?.classList.add("hidden");
      new ResizeObserver(() => sim.handleResize()).observe(canvas);
      observeTheme(() => sim.updateColors(isDark() ? DARK : LIGHT));
    });
  }
</script>

---
title: "高次元点群の探索"
description: "高次元点群を探索するアプリ。"
date: 2023-12-15
image: "/images/flowatlas-thumbnail.mp4"
tags: ["データ可視化", "Julia", "フローサイトメトリー"]
order: 4
locale: "ja"
---

### フローサイトメトリーとは何か、なぜ高次元なのか？

フローサイトメトリーは、数億個の細胞を含みうる生物学的サンプルから異なる細胞タイプを識別する強力な技術だ。以下は、細胞がどうやって高次元の点になるかを示す簡略図。

<figure>
  <img src="/images/cytometer.png" alt="フローサイトメーターの模式図" />
  <figcaption>a) フローサイトメーターの模式図：細胞は一列に並んでレーザーに提示される。レーザーにより各細胞から蛍光が発生し、検出器で測定される。b) ゲーティング戦略により、二次元投影を通じて細胞タイプが識別される。各細胞は実際には蛍光測定値を成分とする高次元の点である。</figcaption>
</figure>

### OpenLayersでギガスケール点群をナビゲートする

二次元投影で高次元データを探索する代わりに、自己組織化マップ（<a href="https://pubmed.ncbi.nlm.nih.gov/33205814/">M. Kratochvil et al. 2020</a>）などの次元削減手法を使えば、点群の高次元空間に埋め込まれた二次元多様体を学習し、すべての点への射影距離を最小化できる。

こうした二次元埋め込みは、異なる細胞タイプとその関係を俯瞰できるので、シングルセル系の論文では定番の図になっている。ただしデータセットが数億点に達すると、一度に全部表示しようとして図が混み合い、見づらくなってしまう。

ここで<a href="https://openlayers.org/">OpenLayers</a>の出番。データセット全体を固定解像度でレンダリングする代わりに、埋め込みデータをタイル化して異なる解像度の四分木として整理する。ビューボックスの範囲とズームレベルに応じて<a href="https://docs.maptiler.com/google-maps-coordinates-tile-bounds-projection/#7/-55.46/-22.85">必要なタイルだけをレンダリング</a>する仕組みだ。地球全体の衛星画像をナビゲートするのと同じアルゴリズムで、数百GBのデータをメモリに載せる必要がない。

さらに<a href="https://d3js.org/">D3.js</a>を使えば、静的な図のパネルに収まっていたようなインタラクティブ機能をこの可視化に追加できる。下の図では、各点をその細胞の蛍光測定値で色分けして、埋め込み内のクラスターが何を意味するかを特定している。

<figure>
  <video autoplay loop muted playsinline src="/images/channels.mp4" aria-label="点群の再着色"></video>
  <figcaption>異なる蛍光測定値により数億の点を瞬時に再着色し、点群内の異なるクラスターの意味を識別する</figcaption>
</figure>

この機能やその他のデータ探索機能は<a href="https://github.com/gszep/FlowAtlas.jl">FlowAtlas.jl</a>で使える。

### 参考文献

V. Coppard, G. Szep et al. 2023. FlowAtlas.jl: an interactive tool bridging FlowJo with computational tools in Julia. bioRxiv, 2023.12.21.572741

MetaCarta and Dev Team. OpenLayers, 2006.

---
title: "ブルータリズムと鉛筆シェーダー"
description: "Unityでブルータリスト環境×鉛筆シェーダーの実験。"
date: 2023-06-20
image: "/images/pencil-shader-thumbnail.mp4"
tags: ["シェーダー", "Unity", "ジェネラティブアート"]
order: 3
locale: "ja"
---

### ブルータリスト建築の鉛筆画の中を歩く

ブルータリスト建築の鉛筆画の中を探索するウォーキングシミュレーションを作りたい。以下は目指しているスタイルの例。

<figure>
  <img src="/images/brutalism-pencil.jpg" alt="ブルータリスト建築の鉛筆画" />
  <figcaption>ブルータリスト建築の鉛筆画</figcaption>
</figure>

プレイヤーが環境内を歩くにつれて、鉛筆のストロークとシェーディングが雰囲気を反映して変わる。穏やかな場面ではゆっくりした直線的なストローク、危険な場面では太く混沌としたストローク。以下にリファレンスをいくつか。

<figure>
  <img src="/images/shading-styles.png" alt="シェーディングスタイルのリファレンス" />
  <figcaption>リファレンスとして使用するシェーディングスタイル</figcaption>
</figure>

### シェーダーとしての鉛筆ストロークはどう見える？

<a href="https://www.youtube.com/watch?v=X-iSQQgOd1A">粘菌シミュレーション</a>からインスピレーションを得て、コンピュートシェーダーで各鉛筆の位置と速度の更新ルールを定義する。ただし粘菌のように鉛筆同士が反応するわけではなく、鉛筆はレンダリングパイプラインのポストプロセッシングエフェクトとして機能する。

<figure>
  <video autoplay loop muted playsinline src="/images/color-pencil.mp4" aria-label="法線マップ付き鉛筆シェーダー"></video>
  <figcaption>法線マップ付き鉛筆シェーダーの例</figcaption>
</figure>

作るシェーダーは、鉛筆にこんな動きをさせる：

- エッジがあればエッジに沿う
- 平面上では一方向に移動
- 光源/深度に応じて太さが変わる
- 有限の長さの軌跡を残す

HLSLコードは<a href="https://github.com/gszep/pencil-shader">このリポジトリ</a>で公開している。

### 次のステップ

動く鉛筆が多すぎてちょっとカオス。ウォーキングシミュレーションをプレイ可能にするには、フレーム間の一貫性をもっと上げないといけない。コンピュートシェーダーをバックグラウンドで複数パス回して、鉛筆シミュレーションが「定常状態」に達してから画像をレンダリングすればいい。手描きアニメーションみたいなストップモーション感が出るはずだ。

---
title: "ブルータリズムと鉛筆シェーダー"
description: "Unityのブルータリスト環境における鉛筆シェーダーの実験。"
date: 2023-06-20
image: "/images/pencil-shader-thumbnail.mp4"
tags: ["シェーダー", "Unity", "ジェネラティブアート"]
order: 3
locale: "ja"
---

### ブルータリスト建築の鉛筆画の中を歩く

ブルータリスト建築の鉛筆画の中を探索するウォーキングシミュレーションを作りたいと考えています。以下は目指しているスタイルの例です。

<figure>
  <img src="/images/brutalism-pencil.jpg" alt="ブルータリスト建築の鉛筆画" />
  <figcaption>ブルータリスト建築の鉛筆画</figcaption>
</figure>

プレイヤーが環境内を歩くにつれて、鉛筆のストロークとシェーディングのスタイルが雰囲気を反映して変化します。穏やかな場面ではゆっくりとした直線的なストローク、危険な場面では太く混沌としたストロークになります。以下にリファレンスとして使用するいくつかの例を示します。

<figure>
  <img src="/images/shading-styles.png" alt="シェーディングスタイルのリファレンス" />
  <figcaption>リファレンスとして使用するシェーディングスタイル</figcaption>
</figure>

### シェーダーとしての鉛筆ストロークはどのように見えるか？

<a href="https://www.youtube.com/watch?v=X-iSQQgOd1A">粘菌シミュレーション</a>からインスピレーションを得て、コンピュートシェーダーを使って各鉛筆の位置と速度の更新ルールを定義します。私たちの場合、粘菌のように鉛筆同士が反応するのではなく、鉛筆はレンダリングパイプラインのポストプロセッシングエフェクトとして機能します。

<figure>
  <video autoplay loop muted playsinline src="/images/color-pencil.mp4" aria-label="法線マップ付き鉛筆シェーダー"></video>
  <figcaption>法線マップ付き鉛筆シェーダーの例</figcaption>
</figure>

作成するシェーダーは、鉛筆に以下の動作をさせる必要があります：

- エッジがある場合はエッジに沿って動く
- 平面上では一方向に移動する
- 光源/深度に応じて太さが変化する
- 有限の長さの軌跡を残す

これらのルールのHLSLコードは<a href="https://github.com/gszep/pencil-shader">このリポジトリ</a>で公開されています。

### 今後の展望

動く鉛筆が多すぎて情報量が過剰です。ウォーキングシミュレーションをプレイ可能にするには、フレーム間の一貫性をもっと高める必要があります。これはコンピュートシェーダーをバックグラウンドで複数パス実行し、鉛筆シミュレーションが「定常状態」に達してから画像をレンダリングすることで実現できます。これにより、手描きアニメーションのようなストップモーション感のあるウォーキングシミュレーションになるでしょう。